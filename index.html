<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Calculadora de Vendas ‚Äî Azul Clara</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --accent:#3399FF;
  --accent-2:#66CCFF;
  --bg:rgba(18,28,45,0.25);
  --text:#ffffff;
  --card-shadow:0 10px 30px rgba(3,10,23,0.15);
  --bg-image:url('https://picsum.photos/1600/900?blur=3');
}

body{
  margin:0;
  font-family:'Poppins',system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  color:var(--text);
  background:
    linear-gradient(rgba(8,12,20,0.75), rgba(8,12,20,0.75)),
    var(--bg-image) center/cover no-repeat fixed;
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:28px;
}

.app{
  width:100%;
  max-width:980px;
  display:grid;
  grid-template-columns:1fr 380px;
  gap:20px;
}
@media(max-width:900px){.app{grid-template-columns:1fr;}}

.card{
  background: var(--bg);
  border-radius:14px;
  padding:18px;
  box-shadow: var(--card-shadow);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0, 13, 36, 0.85);
}

.logo{display:block; max-width:200px; margin:0 auto 12px auto;}

.items-list{display:flex;flex-direction:column;gap:12px;}
.item-row{
  display:grid;
  grid-template-columns:60px 1fr 120px 80px;
  gap:8px;
  align-items:center;
  padding:12px 10px;
  border-radius:10px; 
  background: linear-gradient(90deg, rgba(51,153,255,0.1), rgba(102,204,255,0.05));
  transition: all 0.3s;
}
.item-row:hover{background: linear-gradient(90deg, rgba(51,153,255,0.2), rgba(102,204,255,0.1));}

.item-row input[type="number"]{
  padding:10px;
  border-radius:8px;
  border:1px solid rgba(0,0,0,0.08);
  width:100%;
  text-align:center;
  font-weight:600;
  font-size:14px;
}
.item-row .iprice{
  padding:10px;
  border-radius:8px;
  background:rgba(51,153,255,0.1); 
  font-weight:700; 
  text-align:center;
  font-size:14px;
}
.item-row i{
  font-size:28px;
  color:var(--accent);
  display:flex;
  justify-content:center;
}

.total-line{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:12px;
  font-weight:700;
  font-size:18px;
  background: linear-gradient(90deg,var(--accent),var(--accent-2));
  color:white; 
  padding:8px 14px; 
  border-radius:8px; 
  transition: all 0.3s ease;
}

button.btn{
  background:var(--accent); 
  color:white; 
  border:none; 
  padding:10px 12px; 
  border-radius:10px; 
  cursor:pointer; 
  display:inline-flex; 
  align-items:center; 
  gap:6px; 
  font-weight:600;
}
button.btn.ghost{
  background:transparent; 
  border:1px solid rgba(0,0,0,0.08); 
  color:var(--text);
}
button.small{padding:6px 8px; font-size:14px;}
table{width:100%;border-collapse:collapse;font-size:14px;margin-top:12px;}
th,td{text-align:left;padding:10px 8px;}
th{color:white;background: linear-gradient(90deg,var(--accent),var(--accent-2)); font-weight:600;border-radius:8px;}
td.right{text-align:right;}
td.item-name{display:flex;align-items:center;gap:8px;}
.history-item{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:10px;
  border-radius:8px;
  background: linear-gradient(180deg, rgba(51,153,255,0.15), rgba(102,204,255,0.05));
  margin-bottom:8px;
  align-items:center;
}
.item-row span.iprice, #totalValue, td.right { transition: all 0.3s ease; }
.top-bar{display:flex;justify-content:center;align-items:center;margin-bottom:8px; gap:10px;}
.qty-btn {
  background: var(--accent);
  color: white;
  border: none;
  width: 28px;
  height: 28px;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.2s;
}

.qty-btn:hover {
  background: var(--accent-2);
}

.qty-value {
  font-weight: bold;
  width: 26px;
  text-align: center;
  font-size: 16px;
}

</style>
</head>
<body>
<div class="app">
  <div class="card calculator">
    <img src="https://cdn.discordapp.com/attachments/955108700744470580/1419830211188494386/ChatGPT_Image_22_de_set._de_2025_20_37_52.png" alt="Logo" class="logo">

    <div class="top-bar">
      <h1><i class="fa-solid fa-calculator"></i> Calculadora CUS</h1>
    </div>

    <button class="btn small" id="toggleCostPrice" style="margin-bottom:10px;">
  <i class="fa-solid fa-coins"></i> Pre√ßo de Custo: OFF
</button>


    <!-- Passaporte / Cliente -->
    <div style="margin-bottom:10px;">
      <label for="clientPass">Passaporte / Paciente:</label>
      <input type="text" id="clientPass" placeholder="Ex: 123456789" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid rgba(0,0,0,0.1); font-size:14px;">
    </div>

    <div class="items-list" id="itemsList"></div>

    <div class="table-wrap">
      <table>
        <thead><tr><th>Item</th><th>Qtd</th><th class="right">Subtotal (R$)</th></tr></thead>
        <tbody id="vendaTable"></tbody>
      </table>
    </div>

    <div class="total-line"><div>Total</div><div id="totalValue">R$ 0,00</div></div>

    <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
      <button class="btn" id="btnSaveSale"><i class="fa-solid fa-circle-check"></i> Salvar Venda</button>
      <button class="btn ghost" id="btnReset"><i class="fa-solid fa-rotate-right"></i> Limpar</button>
    </div>
  </div>

  <div class="card right-col">
    <h3><i class="fa-solid fa-clock-rotate-left"></i> Hist√≥rico de Vendas</h3>
    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
      <button class="btn" id="downloadCSV"><i class="fa-solid fa-file-csv"></i> CSV</button>
      <button class="btn" id="downloadPDF"><i class="fa-solid fa-file-pdf"></i> PDF</button>
      <button class="btn ghost" id="clearHistory"><i class="fa-solid fa-trash"></i> Limpar</button>
    </div>
    <div id="historyList" style="margin-top:10px;"></div>
  </div>
</div>

<!-- RODAP√â ADICIONADO -->
<div style="text-align:center; margin-top:20px; opacity:0.85; font-size:14px; font-weight:600;">
  Desenvolvido por <span style="color:#3399FF;">Natanael Fernandes</span>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>

  // Som de clique
const clickSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-interface-click-1126.mp3");

// Fun√ß√£o para tocar sem delay
function playClick() {
  clickSound.currentTime = 0;
  clickSound.play();
}

(() => {
  const bgImage = "https://media.discordapp.net/attachments/1300589527873753145/1472307695930573001/Captura_de_Tela_104.png?ex=699218e4&is=6990c764&hm=e72ab241774bf8f0fff8472bc95b8644d8a6698079de6a00d960e7d6d5b978ef&=&format=webp&quality=lossless&width=1522&height=856"; // üîµ LINK DA IMAGEM DE FUNDO (troque aqui)
  const logoImage = "https://cdn.discordapp.com/attachments/955108700744470580/1447452871619776694/logoCUS.png?ex=6937ad08&is=69365b88&hm=87ff4f4e835faf60e20338356247f4bc8a07cd322dd1536d841771747ba5ccb5&.png"; // üîµ LINK DA LOGO (troque aqui) 
  document.documentElement.style.setProperty('--bg-image', `url('${bgImage}')`);
  document.querySelector('.logo').src = logoImage;

  const formatBR=n=>n.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});
  let currentItems=[], history=JSON.parse(localStorage.getItem('calc_history_v1')||'[]');
  const itemsListEl=document.getElementById('itemsList'), vendaTableBody=document.getElementById('vendaTable'), totalValueEl=document.getElementById('totalValue'), historyListEl=document.getElementById('historyList');

  const defaultItems=[
  {name:'Bandagem', price:400, icon:'fa-bandage'},
  {name:'Kit M√©dico', price:700, icon:'fa-kit-medical'},
  {name:'Calmante', price:1000, icon:'fa-capsules'},
  {name:'Tratamento', price:500, icon:'fa-user-nurse'}
  ];

  // Estado do modo de pre√ßo de custo
let costMode = false;

// Pre√ßos normais
const normalPrices = {
  'Bandagem': 400,
  'Kit M√©dico': 700,
  'Calmante': 1000,
  'Tratamento': 500
};

// Pre√ßos de custo solicitados
const costPrices = {
  'Bandagem': 150,
  'Kit M√©dico': 350,
  'Calmante': 700,
  'Tratamento': 500 // mesmo valor
};

// Alternar pre√ßos ao clicar no bot√£o
document.getElementById('toggleCostPrice').addEventListener('click', () => {
  costMode = !costMode;

  const btn = document.getElementById('toggleCostPrice');

  if (costMode) {
    btn.innerHTML = `<i class="fa-solid fa-coins"></i> Pre√ßo de Custo: ON`;
    btn.style.background = "#2ecc71"; // verde elegante
  } else {
    btn.innerHTML = `<i class="fa-solid fa-coins"></i> Pre√ßo de Custo: OFF`;
    btn.style.background = "var(--accent)";
  }

  const rows = Array.from(document.querySelectorAll('.item-row'));

  rows.forEach(row => {
    const name = row.querySelector('.iname').textContent.trim();
    const priceEl = row.querySelector('.iprice');

    const price = costMode ? costPrices[name] : normalPrices[name];

    priceEl.textContent = `R$ ${formatBR(price)}`;
  });

  recalcPreview();
});


function createItemRow(data) {
  const div = document.createElement('div');
  div.className = 'item-row';

  div.innerHTML = `
    <i class="fa-solid ${data.icon}"></i>
    <div class="iname">${data.name}</div>

    <div style="display:flex; align-items:center; gap:6px; justify-content:center;">
  <button class="qty-btn minus">‚Äì</button>
  
  <input type="number" 
         class="qty-input" 
         value="0" 
         min="0" 
         style="width:55px; text-align:center; font-weight:700; border-radius:8px; border:1px solid rgba(0,0,0,0.1); padding:6px;">
  
  <button class="qty-btn plus">+</button>
</div>

    <span class="iprice">R$ ${formatBR(data.price)}</span>
  `;

  const qtyInput = div.querySelector('.qty-input');
  const btnPlus = div.querySelector('.plus');
  const btnMinus = div.querySelector('.minus');

btnPlus.addEventListener('click', () => {
  playClick();
  qtyInput.value = parseInt(qtyInput.value || 0) + 1;
  recalcPreview();
});

btnMinus.addEventListener('click', () => {
  playClick();
  let current = parseInt(qtyInput.value || 0);
if (current > 0) {
  qtyInput.value = current - 1;
    recalcPreview();
  }
});

qtyInput.addEventListener('input', () => {
  if (qtyInput.value < 0) qtyInput.value = 0;
  recalcPreview();
});



  return div;
}


  function addFixedRows(){ itemsListEl.innerHTML=''; defaultItems.forEach(it=>itemsListEl.appendChild(createItemRow(it))); recalcPreview(); }

  function recalcPreview(){
    const rows=Array.from(itemsListEl.querySelectorAll('.item-row'));
    currentItems=rows.map(r=>{
      const name=r.querySelector('.iname').textContent;
      const price=parseFloat(
        r.querySelector('.iprice').textContent
          .replace(/\./g,'')
          .replace(',', '.')
          .replace(/[^\d.]/g,'')
      )||0;
      const qty = parseInt(r.querySelector('.qty-input').value) || 0;
      return {name, price, qty, subtotal:Math.max(0,price*qty)};
    }).filter(it=>it.qty>0);

    vendaTableBody.innerHTML='';
    let total=0;
    currentItems.forEach(it=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${it.name}</td><td>${it.qty}</td><td class="right">R$ ${formatBR(it.subtotal)}</td>`;
      vendaTableBody.appendChild(tr);
      total+=it.subtotal;
    });

    let start=0, end=total, duration=400;
    const startTime=performance.now();
    function animate(time){
      let progress=Math.min((time-startTime)/duration,1);
      let displayValue=start + (end-start)*progress;
      totalValueEl.textContent=`R$ ${formatBR(displayValue)}`;
      if(progress<1) requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
  }

  function saveSale(){
    recalcPreview();
    if(currentItems.length===0){alert('Nenhum item v√°lido.'); return;}
    const total=currentItems.reduce((s,i)=>s+i.subtotal,0);
    const timestamp=new Date().toLocaleString('pt-BR');
    const clientPass=document.getElementById('clientPass').value || '-';
    const record={id:Date.now(), timestamp, total, items:currentItems, clientPass};
    history.unshift(record);
    if(history.length>200) history=history.slice(0,200);
    localStorage.setItem('calc_history_v1',JSON.stringify(history));
    renderHistory();
    itemsListEl.querySelectorAll('.qty-input').forEach(q => q.value = 0);
    document.getElementById('clientPass').value='';
    recalcPreview();
  }

  function renderHistory(){
    historyListEl.innerHTML='';
    if(history.length===0){historyListEl.innerHTML='<div style="padding:12px;color:rgba(255,255,255,0.5)">Nenhuma venda registrada.</div>'; return;}
    history.forEach(record=>{
      const div=document.createElement('div'); div.className='history-item';
      const left=document.createElement('div');
      left.innerHTML=`<div style="font-weight:600">R$ ${formatBR(record.total)}</div>
                      <div class="history-meta">${record.timestamp}</div>
                      <div style="font-size:12px;color:rgba(0,0,0,0.6)">Passaporte: ${record.clientPass}</div>`;
      const right=document.createElement('div'); right.style.textAlign='right';
      right.innerHTML=`<button class="btn small" data-id="${record.id}"><i class="fa-solid fa-eye"></i> Ver</button>
                       <button class="btn small ghost" data-del="${record.id}"><i class="fa-solid fa-trash"></i></button>`;
      div.appendChild(left); div.appendChild(right); historyListEl.appendChild(div);
      right.querySelector('[data-id]').addEventListener('click',()=>{const rec=history.find(h=>h.id==record.id); if(!rec) return; alert(`${rec.timestamp}\nTotal: R$ ${formatBR(rec.total)}\nPassaporte: ${rec.clientPass}\n\nItens:\n${rec.items.map(it=>`${it.name} x${it.qty} = R$ ${formatBR(it.subtotal)}`).join('\n')}`)});
      right.querySelector('[data-del]').addEventListener('click',e=>{if(!confirm('Remover registro?')) return; const id=parseInt(e.currentTarget.getAttribute('data-del')); history=history.filter(h=>h.id!==id); localStorage.setItem('calc_history_v1',JSON.stringify(history)); renderHistory();});
    });
  }

  document.getElementById('btnSaveSale').addEventListener('click',saveSale);
  document.getElementById('btnReset').addEventListener('click',()=>{if(confirm('Limpar campos?')) addFixedRows();});
  document.getElementById('clearHistory').addEventListener('click',()=>{if(confirm('Limpar hist√≥rico?')){history=[]; localStorage.removeItem('calc_history_v1'); renderHistory();}});
  document.getElementById('downloadCSV').addEventListener('click',()=>{if(history.length===0){alert('N√£o h√° hist√≥rico.'); return;} let csv='Timestamp,Total (R$),Passaporte,Itens\n'; history.forEach(h=>{const itemsStr=h.items.map(i=>`${i.name} x${i.qty} (R$ ${formatBR(i.subtotal)})`).join(' | '); csv+=`"${h.timestamp}",${h.total.toFixed(2)},"${h.clientPass}","${itemsStr.replaceAll('"','""')}"\n`;}); const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='historico_vendas.csv'; a.click(); URL.revokeObjectURL(url);});
  document.getElementById('downloadPDF').addEventListener('click',async()=>{if(history.length===0){alert('N√£o h√° hist√≥rico.'); return;} const {jsPDF}=window.jspdf; const doc=new jsPDF({unit:'pt',format:'a4'}); doc.setFontSize(14); doc.text('Hist√≥rico de Vendas',40,40); let y=70; const lineHeight=16; history.forEach(h=>{if(y>740){doc.addPage(); y=40;} doc.setDrawColor(180); doc.setLineWidth(0.5); doc.line(40, y-4, 555, y-4); doc.setFontSize(11); doc.text(`${h.timestamp} ‚Äî Total: R$ ${formatBR(h.total)}`,40,y); y+=lineHeight; doc.setFontSize(10); doc.text(`Cliente/Passaporte: ${h.clientPass}`,40,y); y+=lineHeight; const itemsTxt=h.items.map(it=>`${it.name} x${it.qty} = R$ ${formatBR(it.subtotal)}`).join(' ; '); const split=doc.splitTextToSize(itemsTxt,500); doc.text(split,60,y); y+=split.length*lineHeight+8;}); doc.save('historico_vendas.pdf');});

  addFixedRows(); renderHistory();
})();
</script>
</body>
</html>
